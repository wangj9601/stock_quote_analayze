<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PDF下载功能测试</title>
    <link rel="stylesheet" href="frontend/css/stock.css">
    <link rel="stylesheet" href="frontend/css/common.css">
</head>
<body>
    <div style="padding: 2rem; max-width: 800px; margin: 0 auto;">
        <h1>PDF下载功能测试</h1>
        
        <div class="research-item">
            <div class="research-header">
                <h4>测试研报标题</h4>
                <div class="research-meta">
                    <span class="research-firm">测试机构</span>
                    <span class="research-date">2025-01-20</span>
                    <span class="research-rating buy">买入</span>
                </div>
            </div>
            <p class="research-summary">这是一个测试研报的摘要信息，用于验证PDF下载功能是否正常工作。</p>
            <a href="#" class="research-link" onclick="testDownloadPDF()">下载报告</a>
        </div>
        
        <div id="toast-container"></div>
    </div>

    <script src="frontend/js/common.js"></script>
    <script>
        // 简化的测试下载函数
        function testDownloadPDF() {
            // 使用一个测试PDF URL
            const testURL = "https://www.w3.org/WAI/ER/tests/xhtml/testfiles/resources/pdf/dummy.pdf";
            const title = "测试研报";
            
            try {
                console.log('[testDownloadPDF] 开始下载PDF:', testURL, title);
                
                // 创建一个隐藏的链接元素
                const link = document.createElement('a');
                link.style.display = 'none';
                
                // 设置下载属性
                link.href = testURL;
                link.download = `${title}.pdf`;
                
                // 添加到DOM并点击下载
                document.body.appendChild(link);
                link.click();
                
                // 清理
                document.body.removeChild(link);
                
                if (typeof CommonUtils !== 'undefined' && CommonUtils.showToast) {
                    CommonUtils.showToast(`开始下载: ${title}`, 'success');
                } else {
                    alert(`开始下载: ${title}`);
                }
                
            } catch (error) {
                console.error('[testDownloadPDF] 下载失败:', error);
                if (typeof CommonUtils !== 'undefined' && CommonUtils.showToast) {
                    CommonUtils.showToast('下载失败，请重试', 'error');
                } else {
                    alert('下载失败，请重试');
                }
            }
        }
    </script>
</body>
</html> 