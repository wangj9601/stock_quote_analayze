# InStock股票系统需求规格说明文档

## 1. 项目概述

### 1.1 项目背景
InStock股票系统是一个专业的量化投资辅助工具，旨在为投资者提供全面的股票数据分析、选股策略和自动交易功能。系统通过抓取每日股票和ETF关键数据，结合技术分析指标和形态识别，帮助用户进行科学的投资决策。

### 1.2 项目目标
- 提供全面的股票数据采集和分析功能
- 实现多种选股策略和技术指标计算
- 支持策略回测和验证
- 提供自动交易功能
- 确保系统运行高效，支持多平台部署

### 1.3 适用范围
- 个人投资者
- 量化投资机构
- 股票分析师
- 投资研究人员

## 2. 功能需求

### 2.1 数据采集功能
#### 2.1.1 股票数据采集
1. 每日股票基础数据采集
   - 输入：股票代码列表、交易日期
   - 输出：包含以下字段的数据表
     * 股票代码、股票名称
     * 开盘价、收盘价、最高价、最低价
     * 成交量、成交额
     * 涨跌幅、振幅
     * 换手率、量比
     * 市盈率、市净率
     * 总市值、流通市值
   - 处理流程：
     * 自动获取交易日历
     * 支持实时和历史数据采集
     * 异常数据自动重试
     * 数据完整性校验

2. 股票资金流向数据采集
   - 输入：股票代码列表、交易日期
   - 输出：包含以下字段的数据表
     * 股票代码、股票名称
     * 主力净流入、主力净占比
     * 超大单净流入、超大单净占比
     * 大单净流入、大单净占比
     * 中单净流入、中单净占比
     * 小单净流入、小单净占比
   - 处理流程：
     * 实时采集当日数据
     * 支持历史数据补采
     * 数据异常自动告警

3. 股票分红配送数据采集
   - 输入：股票代码列表、分红日期范围
   - 输出：包含以下字段的数据表
     * 股票代码、股票名称
     * 分红方案（每10股派息、送股、转增）
     * 股权登记日
     * 除权除息日
     * 派息日
     * 红股上市日
   - 处理流程：
     * 定期扫描分红公告
     * 自动更新分红数据
     * 支持历史分红查询

4. 股票龙虎榜数据采集
   - 输入：交易日期
   - 输出：包含以下字段的数据表
     * 股票代码、股票名称
     * 上榜原因
     * 买入金额、卖出金额
     * 买入营业部、卖出营业部
     * 买入占比、卖出占比
   - 处理流程：
     * 每日收盘后采集
     * 支持历史数据查询
     * 异常数据标记

5. 股票大宗交易数据采集
   - 输入：交易日期
   - 输出：包含以下字段的数据表
     * 股票代码、股票名称
     * 成交价格、成交数量
     * 成交金额、折溢价率
     * 买方营业部、卖方营业部
   - 处理流程：
     * 实时采集大宗交易数据
     * 支持历史数据查询
     * 数据异常检测

6. 股票基本面数据采集
   - 输入：股票代码列表
   - 输出：包含以下字段的数据表
     * 股票代码、股票名称
     * 所属行业、所属概念
     * 主营业务
     * 财务指标（营收、利润、毛利率等）
     * 股东结构
     * 公司治理信息
   - 处理流程：
     * 定期更新基本面数据
     * 支持历史数据查询
     * 数据变更追踪

7. 行业资金流向数据采集
   - 输入：行业代码列表、交易日期
   - 输出：包含以下字段的数据表
     * 行业代码、行业名称
     * 行业涨跌幅
     * 行业资金净流入
     * 行业资金净占比
     * 行业成交额
     * 行业换手率
   - 处理流程：
     * 实时计算行业资金流向
     * 支持历史数据查询
     * 行业分类自动更新

8. 概念资金流向数据采集
   - 输入：概念代码列表、交易日期
   - 输出：包含以下字段的数据表
     * 概念代码、概念名称
     * 概念涨跌幅
     * 概念资金净流入
     * 概念资金净占比
     * 概念成交额
     * 概念换手率
   - 处理流程：
     * 实时计算概念资金流向
     * 支持历史数据查询
     * 概念分类自动更新

9. ETF数据采集
   - 输入：ETF代码列表、交易日期
   - 输出：包含以下字段的数据表
     * ETF代码、ETF名称
     * 开盘价、收盘价、最高价、最低价
     * 成交量、成交额
     * 涨跌幅、振幅
     * 换手率、量比
     * 基金规模、基金净值
   - 处理流程：
     * 实时采集ETF数据
     * 支持历史数据查询
     * 数据异常检测

#### 2.1.2 数据存储
1. 数据库设计
   - 输入：各类数据采集结果
   - 输出：结构化的数据库表
   - 具体要求：
     * 采用MySQL数据库
     * 支持分表存储
     * 建立合适的索引
     * 实现数据分区
     * 支持数据备份

2. 历史数据管理
   - 输入：历史数据文件、数据更新请求
   - 输出：更新后的数据库记录
   - 功能要求：
     * 支持数据导入导出
     * 支持数据版本控制
     * 支持数据恢复
     * 支持数据压缩存储

3. 数据扩展分析
   - 输入：原始数据、分析参数
   - 输出：分析结果数据表
   - 功能要求：
     * 支持自定义分析指标
     * 支持数据聚合计算
     * 支持数据关联分析
     * 支持数据挖掘算法

4. 数据统计和挖掘
   - 输入：分析目标、统计参数
   - 输出：统计结果、挖掘报告
   - 功能要求：
     * 支持多维度统计
     * 支持趋势分析
     * 支持相关性分析
     * 支持预测模型

5. 数据表管理
   - 输入：表结构定义、数据操作请求
   - 输出：数据库操作结果
   - 功能要求：
     * 自动创建数据表
     * 自动更新表结构
     * 支持表分区
     * 支持表优化

6. 批量数据处理
   - 输入：批量数据、处理参数
   - 输出：处理结果
   - 功能要求：
     * 支持批量插入
     * 支持批量更新
     * 支持事务处理
     * 支持并发控制

### 2.2 技术分析功能
#### 2.2.1 技术指标计算
1. 指标计算引擎
   - 输入：股票数据、指标参数
   - 输出：指标计算结果
   - 计算要求：
     * 基于talib库实现
     * 支持自定义参数
     * 支持批量计算
     * 结果与主流软件一致

2. 具体指标实现
   a. MACD指标
      - 输入：收盘价序列、快线周期、慢线周期、信号线周期
      - 输出：DIF、DEA、MACD值
      - 计算要求：支持自定义参数，结果与同花顺一致

   b. KDJ指标
      - 输入：最高价、最低价、收盘价序列、周期参数
      - 输出：K值、D值、J值
      - 计算要求：支持自定义参数，结果与通达信一致

   // ... 其他指标类似详细说明 ...

#### 2.2.2 K线形态识别
1. 形态识别引擎
   - 输入：K线数据、形态参数
   - 输出：形态识别结果
   - 识别要求：
     * 支持61种标准形态
     * 支持自定义形态
     * 识别结果包含信号强度
     * 支持批量识别

2. 具体形态识别
   a. 两只乌鸦形态
      - 输入：K线数据（开盘价、收盘价、最高价、最低价）
      - 输出：形态识别结果（-1：卖出信号，0：无信号，1：买入信号）
      - 识别要求：
        * 第一根为阳线
        * 第二根为阴线，开盘价高于前一根收盘价
        * 第三根为阴线，开盘价高于前一根开盘价

   // ... 其他形态类似详细说明 ...

#### 2.2.3 筹码分布分析
1. 筹码计算引擎
   - 输入：历史交易数据、计算参数
   - 输出：筹码分布数据
   - 计算要求：
     * 支持自定义时间范围
     * 支持不同计算方法
     * 结果与东方财富一致
     * 支持批量计算

2. 具体分析功能
   a. 成本分布计算
      - 输入：历史成交数据、流通股本
      - 输出：各价位持仓比例
      - 计算要求：
        * 支持不同时间周期
        * 支持不同计算方法
        * 结果可视化展示

   b. 获利比例计算
      - 输入：当前价格、成本分布数据
      - 输出：获利比例、套牢比例
      - 计算要求：
        * 实时计算
        * 支持历史数据查询
        * 支持批量计算

// ... 继续细化其他功能模块 ...

### 2.3 选股功能
#### 2.3.1 综合选股
1. 选股条件配置
   - 输入：选股条件参数
   - 输出：选股结果列表
   - 功能要求：
     * 支持200+选股条件
     * 支持条件组合
     * 支持条件保存
     * 支持条件导入导出

2. 具体选股条件
   a. 股票范围选股
      - 输入：市场、行业、地区、概念等参数
      - 输出：符合条件的股票列表
      - 选股要求：
        * 支持多选
        * 支持排除
        * 支持自定义范围

   // ... 其他选股条件类似详细说明 ...

// ... 继续细化其他功能模块 ...

### 2.4 策略验证功能
1. 回测引擎
   - 输入：策略参数、历史数据、回测时间范围
   - 输出：回测结果报告
   - 功能要求：
     * 支持多策略并行回测
     * 支持自定义回测周期
     * 支持参数优化
     * 支持结果可视化

2. 具体回测功能
   a. 策略回测
      - 输入：策略代码、回测参数、历史数据
      - 输出：回测结果（收益率、最大回撤、夏普比率等）
      - 回测要求：
        * 支持日线、分钟线回测
        * 考虑交易成本
        * 支持滑点模拟
        * 支持资金管理

   b. 策略评估
      - 输入：回测结果、评估参数
      - 输出：评估报告
      - 评估指标：
        * 年化收益率
        * 最大回撤
        * 夏普比率
        * 信息比率
        * 胜率
        * 盈亏比

   c. 参数优化
      - 输入：策略代码、参数范围、优化目标
      - 输出：最优参数组合
      - 优化要求：
        * 支持网格搜索
        * 支持遗传算法
        * 支持多目标优化
        * 防止过拟合

### 2.5 自动交易功能
1. 交易引擎
   - 输入：交易策略、账户信息、交易参数
   - 输出：交易执行结果
   - 功能要求：
     * 支持实时行情接入
     * 支持多账户管理
     * 支持风险控制
     * 支持交易日志

2. 具体交易功能
   a. 打新股策略
      - 输入：新股信息、账户资金、申购参数
      - 输出：申购结果
      - 交易要求：
        * 自动识别新股
        * 自动计算申购数量
        * 自动执行申购
        * 申购结果通知

   b. 自定义交易策略
      - 输入：策略代码、交易参数、风控参数
      - 输出：交易信号、执行结果
      - 功能要求：
        * 支持策略编写
        * 支持参数配置
        * 支持实时监控
        * 支持紧急平仓

   c. 交易风控
      - 输入：交易指令、风控参数
      - 输出：风控检查结果
      - 风控要求：
        * 资金使用限制
        * 持仓限制
        * 亏损限制
        * 交易频率限制

   d. 交易日志
      - 输入：交易记录、系统日志
      - 输出：日志文件
      - 日志要求：
        * 记录所有交易
        * 记录系统状态
        * 记录异常情况
        * 支持日志分析

### 2.6 用户交互功能
#### 2.6.1 关注功能
1. 股票关注管理
   - 输入：股票代码、关注设置
   - 输出：关注列表
   - 功能要求：
     * 支持添加/删除关注
     * 支持关注分组
     * 支持关注提醒
     * 支持关注导出

2. 关注展示
   - 输入：关注列表、展示参数
   - 输出：关注股票展示
   - 展示要求：
     * 置顶显示
     * 标红显示
     * 支持自定义显示
     * 支持数据更新

#### 2.6.2 批量处理功能
1. 作业调度系统
   - 输入：作业配置、时间参数
   - 输出：作业执行结果
   - 功能要求：
     * 支持多种作业模式
     * 支持定时执行
     * 支持并行处理
     * 支持失败重试

2. 具体作业类型
   a. 当前时间作业
      - 输入：作业类型、执行参数
      - 输出：执行结果
      - 执行要求：
        * 自动识别交易日
        * 支持实时数据
        * 支持结果通知
        * 支持异常处理

   b. 历史数据作业
      - 输入：时间范围、作业类型
      - 输出：处理结果
      - 处理要求：
        * 支持时间范围选择
        * 支持数据补全
        * 支持结果验证
        * 支持进度显示

### 2.7 Web展示功能
1. 界面设计
   - 输入：展示配置、用户设置
   - 输出：Web界面
   - 设计要求：
     * 响应式布局
     * 支持多设备
     * 界面美观
     * 操作便捷

2. 具体展示功能
   a. 数据展示
      - 输入：数据查询参数
      - 输出：数据展示页面
      - 展示要求：
        * 支持表格展示
        * 支持图表展示
        * 支持数据导出
        * 支持自定义视图

   b. 图表展示
      - 输入：图表参数、数据
      - 输出：图表展示
      - 图表类型：
        * K线图
        * 分时图
        * 技术指标图
        * 筹码分布图

   c. 交互功能
      - 输入：用户操作
      - 输出：交互响应
      - 功能要求：
        * 支持数据筛选
        * 支持图表缩放
        * 支持数据钻取
        * 支持个性化设置

## 3. 非功能需求

### 3.1 性能需求
- 系统运行高效，采用多线程设计
- 单日数据处理时间控制在4分钟内（普通笔记本配置）
- 支持单例共享资源
- 计算天数越多效率越高

### 3.2 可靠性需求
- 提供完整的日志记录系统
- 支持三种日志类型：
  - stock_execute_job.log（数据抓取、处理、分析）
  - stock_web.log（web服务）
  - stock_trade.log（交易服务）

### 3.3 可维护性需求
- 模块化设计，便于维护和扩展
- 提供完整的调试日志
- 支持Docker容器化部署
- 支持Windows、Linux、MacOS多平台

### 3.4 安全性需求
- 交易功能需要特别的安全控制
- 避免资金风险
- 提供交易日志记录
- 支持交易策略级别的日志配置

### 3.5 可扩展性需求
- 支持自定义选股策略
- 支持自定义K线形态识别
- 支持数据采集扩展
- 支持Web界面自定义配置

## 4. 系统部署需求

### 4.1 环境要求
- Python 3.11或更高版本
- 支持Windows、Linux、MacOS系统
- 支持Docker容器化部署

### 4.2 安装方式
- 常规安装方式
- Docker镜像安装方式
- 支持国内镜像源配置

### 4.3 运行要求
- 需要稳定的网络连接
- 需要足够的存储空间
- 建议使用SSD存储
- 建议配置足够的内存（建议8GB以上）

## 5. 注意事项

### 5.1 使用限制
- 自动交易功能涉及资金安全，需要谨慎使用
- 打新功能在交易日10:00触发，可通过配置关闭
- 部分功能需要网络连接

### 5.2 数据说明
- 数据来源为公开市场数据
- 历史数据需要定期更新
- 部分数据可能存在延迟

### 5.3 免责声明
- 系统提供的分析结果仅供参考
- 投资决策需要用户自行判断
- 自动交易功能需要用户承担相应风险 